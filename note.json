{"paragraphs":[{"text":"%md\n# Bridging Big Data Spark Workbench\nThis notebook connects to a copy of the [National Bridge Inventory](https://www.fhwa.dot.gov/bridge/nbi.cfm) dataset stored in a MongoDB instasnce. It\nloads a single State's data into a spark cluster and runs a kMeans clustering analysis.","user":"anonymous","dateUpdated":"2017-10-02T20:17:43+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Bridging Big Data Spark Workbench</h1>\n<p>This notebook connects to a copy of the <a href=\"https://www.fhwa.dot.gov/bridge/nbi.cfm\">National Bridge Inventory</a> dataset stored in a MongoDB instasnce. It<br/>loads a single State&rsquo;s data into a spark cluster and runs a kMeans clustering analysis.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1506975292577_-105552276","id":"20171002-201452_239023248","dateCreated":"2017-10-02T20:14:52+0000","dateStarted":"2017-10-02T20:17:43+0000","dateFinished":"2017-10-02T20:17:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11983"},{"title":"Connect to Mongo","text":"import com.mongodb.spark._\nimport com.mongodb.spark.config._\nval readConfig = ReadConfig(Map(\"uri\" -> \"mongodb://192.168.100.56:30001/bridge\", \"collection\" -> \"subset\"))\n","user":"anonymous","dateUpdated":"2017-10-02T21:40:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506958544420_1682210503","id":"20171002-153544_2108571394","dateCreated":"2017-10-02T15:35:44+0000","dateStarted":"2017-10-02T21:40:18+0000","dateFinished":"2017-10-02T21:40:06+0000","status":"RUNNING","progressUpdateIntervalMs":500,"$$hashKey":"object:11984","errorMessage":""},{"title":"Read Data from Mongo and Convert to Dataframe","text":"\nval customRdd = MongoSpark.load(sc, readConfig)\nval df = spark.read.json(customRdd.map(x=>x.toJson))\nval df2010 = df.filter(col(\"year\") === 2010)\n","user":"anonymous","dateUpdated":"2017-10-02T18:56:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"df2010: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [InventoryRTeMinVertClearance: double, InventoryRteTotalHorzClearance: double ... 102 more fields]"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1505330125822_0111<br/>Spark WebUI: <a href=\"http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/\">http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/</a>"}]},"apps":[],"jobName":"paragraph_1506958632298_-256215752","id":"20171002-153712_1344155745","dateCreated":"2017-10-02T15:37:12+0000","dateStarted":"2017-10-02T18:33:07+0000","dateFinished":"2017-10-02T18:33:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:11985"},{"title":"Create a kMeans Pipeline","text":"import org.apache.spark.ml.feature.VectorAssembler\nimport org.apache.spark.ml.clustering.KMeans\nimport org.apache.spark.ml.Pipeline\n\nval assembler = new VectorAssembler().setInputCols(Array(\"averageDailyTraffic\", \"sufficiencyRating\", \"yearBuilt\" )).setOutputCol(\"features\")\nval kmeans = new KMeans().setK(5).setFeaturesCol(\"features\").setPredictionCol(\"prediction\")\nval pipeline = new Pipeline().setStages(Array(assembler, kmeans))\nval kMeansPredictionModel = pipeline.fit(df2010)\nval predictionResult = kMeansPredictionModel.transform(df2010)\n","user":"anonymous","dateUpdated":"2017-10-02T19:42:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"predictionResult: org.apache.spark.sql.DataFrame = [InventoryRTeMinVertClearance: double, InventoryRteTotalHorzClearance: double ... 104 more fields]"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1505330125822_0111<br/>Spark WebUI: <a href=\"http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/\">http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/</a>"}]},"apps":[],"jobName":"paragraph_1506961275990_352950073","id":"20171002-162115_1764489919","dateCreated":"2017-10-02T16:21:15+0000","dateStarted":"2017-10-02T19:41:44+0000","dateFinished":"2017-10-02T19:42:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:11986"},{"title":"Register the Resulting Dataframe with SparkSQL","text":"predictionResult.createOrReplaceTempView(\"bridges\")","user":"anonymous","dateUpdated":"2017-10-02T20:18:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<hr/>Spark Application Id: application_1505330125822_0111<br/>Spark WebUI: <a href=\"http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/\">http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/</a>"}]},"apps":[],"jobName":"paragraph_1506968302879_-1472920266","id":"20171002-181822_283097134","dateCreated":"2017-10-02T18:18:22+0000","dateStarted":"2017-10-02T19:43:32+0000","dateFinished":"2017-10-02T19:43:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:11987"},{"text":"%sql\nselect structureNumber, averageDailyTraffic, sufficiencyRating, yearBuilt, prediction from bridges where yearBuilt > 1930 and averageDailyTraffic > 10000 limit 7000","user":"anonymous","dateUpdated":"2017-10-02T20:19:01+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"scatterChart","height":300,"optionOpen":true,"setting":{"scatterChart":{"size":{"name":"sufficiencyRating","index":2,"aggr":"sum"},"group":{"name":"prediction","index":4,"aggr":"sum"},"xAxis":{"name":"sufficiencyRating","index":2,"aggr":"sum"},"yAxis":{"name":"yearBuilt","index":3,"aggr":"sum"}}}},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"structureNumber\taverageDailyTraffic\tsufficiencyRating\tyearBuilt\tprediction\n0231\t24235\t93.0\t1977\t3\n0263\t17551\t50.4\t1963\t0\n0283\t10380\t62.5\t1951\t0\n0390\t14758\t56.6\t1960\t0\n0391\t33072\t79.6\t1988\t3\n0534\t56000\t74.5\t1988\t2\n0535\t42390\t77.0\t1981\t2\n0645\t22707\t84.4\t1982\t3\n0671\t18140\t21.0\t2007\t0\n0699\t42142\t90.8\t1993\t2\n0700\t23729\t85.9\t1973\t3\n0725\t15779\t72.8\t1957\t0\n0732\t12370\t90.2\t1972\t0\n0737\t12757\t39.8\t1965\t0\n0749\t13000\t72.3\t1973\t0\n0797\t17864\t46.1\t1955\t0\n0969\t25249\t59.1\t1966\t3\n0971\t17285\t92.4\t2003\t0\n0997\t17973\t55.3\t1956\t0\n1080\t12675\t83.7\t1969\t0\n1081\t10736\t82.5\t1973\t0\n1121\t26230\t85.0\t1965\t3\n1124\t25260\t85.0\t1965\t3\n1155\t31400\t91.8\t1969\t3\n1160\t56503\t88.1\t1970\t2\n1161\t15250\t91.8\t1975\t0\n1188\t22808\t92.9\t1973\t3\n1191\t15419\t89.3\t1977\t0\n1197\t20795\t91.4\t1973\t3\n1230\t28150\t60.0\t1977\t3\n1244\t14980\t90.4\t1985\t0\n1248\t12277\t75.5\t1985\t0\n1266\t27454\t83.3\t1977\t3\n1269\t23729\t97.8\t1999\t3\n1273\t19137\t81.9\t1973\t3\n1323\t40694\t88.3\t1974\t2\n1324\t56503\t74.0\t1974\t2\n1325\t35252\t78.8\t1974\t3\n1326\t10014\t95.9\t1974\t0\n1328\t10172\t94.2\t1974\t0\n1341\t42390\t82.0\t1974\t2\n1344\t31400\t87.8\t1977\t3\n1367\t30986\t59.7\t1981\t3\n1369\t28150\t66.0\t1977\t3\n1378\t34480\t72.8\t1980\t3\n1380\t35252\t73.6\t1978\t3\n1432\t47058\t95.6\t1991\t2\n1433\t31957\t68.9\t1985\t3\n1441\t27224\t93.4\t1983\t3\n1442\t27224\t93.4\t1982\t3\n1443\t35977\t92.6\t1985\t3\n1525\t22838\t85.8\t1986\t3\n1603\t22946\t76.0\t1985\t3\n1629\t15842\t96.5\t1985\t0\n1694\t35977\t93.6\t1985\t3\n1695\t22946\t77.0\t1985\t3\n1697\t24086\t97.7\t1989\t3\n1705\t14283\t96.7\t1988\t0\n1739\t11909\t85.5\t1992\t0\n1766\t20132\t98.1\t1991\t3\n1767\t12050\t78.7\t1986\t0\n1793\t20619\t98.1\t1993\t3\n1794\t24086\t95.7\t1993\t3\n1808\t20132\t98.1\t1991\t3\n1845\t13610\t81.9\t1992\t0\n1861\t56503\t91.2\t1970\t2\n1863\t20795\t91.4\t1973\t3\n1864\t28150\t60.0\t1977\t3\n1865\t27454\t84.3\t1977\t3\n1867\t30986\t67.2\t1981\t3\n1868\t28150\t61.0\t1977\t3\n1869\t34480\t72.8\t1980\t3\n1878\t14794\t94.6\t1997\t0\n1879\t14794\t94.6\t1997\t0\n1885\t25260\t85.0\t1993\t3\n1887\t25260\t80.0\t1993\t3\n1888\t25260\t80.0\t1993\t3\n1889\t25260\t85.0\t1993\t3\n1897\t11370\t92.9\t2002\t0\n1913\t15250\t90.7\t1995\t0\n1914\t14980\t91.4\t1995\t0\n1922\t19210\t79.0\t1995\t3\n1959\t23371\t92.7\t2002\t3\n1973\t42142\t76.0\t1999\t2\n1989\t28543\t23.2\t2005\t3\n2031\t23924\t94.7\t2002\t3\n2032\t23924\t94.7\t2002\t3\n2033\t23924\t96.7\t2002\t3\n2034\t23924\t96.7\t2003\t3\n2081\t21479\t92.9\t2006\t3\n2082\t21479\t92.9\t2006\t3\n2115\t23839\t89.6\t2004\t3\n2116\t23839\t89.6\t2004\t3\n2117\t21950\t89.8\t2004\t3\n2118\t21950\t89.8\t2004\t3\n2127\t20798\t98.1\t2008\t3\n2147\t12165\t91.8\t2008\t0\n2192\t20798\t98.1\t2008\t3\n2193\t20795\t92.9\t2008\t3\n2194\t20795\t92.9\t2008\t3\n2209\t14843\t7.0\t2008\t0\n4005\t21477\t65.0\t1973\t3\n4032\t25260\t66.0\t1993\t3\n4061\t20795\t82.6\t1973\t3\n4064\t20795\t11.0\t1973\t3\n4067\t22385\t7.0\t1971\t3\n4068\t13340\t28.7\t1998\t0"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1505330125822_0111<br/>Spark WebUI: <a href=\"http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/\">http://nds-spark-slave-1.os.ncsa.edu:8088/proxy/application_1505330125822_0111/</a>"}]},"apps":[],"jobName":"paragraph_1506970154161_-887097121","id":"20171002-184914_430974311","dateCreated":"2017-10-02T18:49:14+0000","dateStarted":"2017-10-02T19:45:38+0000","dateFinished":"2017-10-02T19:45:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:11988"},{"text":"","user":"anonymous","dateUpdated":"2017-10-02T20:18:40+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506973738272_1153727585","id":"20171002-194858_52768933","dateCreated":"2017-10-02T19:48:58+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:11989"}],"name":"Bridging Big Data","id":"2CTWZXKJG","angularObjects":{"2CUN93ZAS:shared_process":[],"2CUXSZXNK:shared_process":[],"2CTTDQHPB:shared_process":[],"2CUVTCQ36:shared_process":[],"2CTW91S5A:shared_process":[],"2CUF1XJND:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}